---
# tasks file for apache

# - name: Update apt repo
#   apt: 
#     update_cache: yes

- name: install apache2
  apt: 
    name: apache2 
    state: latest

- name: install libxml2-dev
  apt: 
    name: libxml2-dev 
    state: latest
  become: true


- name: enable proxy module
  command: a2enmod proxy
  become: true

- name: enable proxy_balancer module
  command: a2enmod proxy_balancer
  become: true

- name: enable proxy_http module
  command: a2enmod proxy_http
  become: true

- name: enable headers module
  command: a2enmod headers
  become: true

- name: enable lbmethod_bytraffic module
  command: a2enmod lbmethod_bytraffic
  become: true

- name: enable rewrite module
  command: a2enmod rewrite
  become: true


- name: restart apache
  service:
      name: apache2
      state: restarted
  become: true

- name: copy ports.conf
  copy:
    src: ../files/ports.conf
    dest: /etc/apache2/ports.conf
  become: true

- name: copy 000-default.conf
  copy:
    src: ../files/000-default.conf
    dest: /etc/apache2/sites-available/000-default.conf
  become: true


- name: restart apache
  service:
      name: apache2
      state: restarted
  become: true

- name: stop apache
  service:
    name: apache
    state: stopped
  when: enable_nginx_lb
